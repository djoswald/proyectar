<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Monitor Producción - Ultra Rápido</title>
    <style>
        /* --- ESTILOS DE PANTALLA COMPLETA --- */
        body {
            background-color: black;
            color: white;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* Sin barras de scroll */
            display: flex;
            flex-direction: column;
        }

        h1 { 
            height: 6vh; 
            margin: 0; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 3.5vh; 
            text-transform: uppercase; 
            background-color: #000;
            letter-spacing: 2px;
            border-bottom: 1px solid #333;
        }

        .grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr; 
            grid-template-rows: 1fr 1fr;    
            gap: 0; /* Sin espacio para maximizar área */
            width: 100vw;
            height: 94vh; 
        }

        .card {
            background-color: #0a0a0a; /* Negro casi puro */
            border: 1px solid #222;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
        }

        /* TIPOGRAFÍA DINÁMICA (VMIN) */
        .label {
            font-size: 5vmin; 
            font-weight: bold;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 2vh;
        }

        .value {
            font-size: 30vmin; /* AÚN MÁS GRANDE */
            font-weight: bold;
            line-height: 0.8;
            color: #fff;
            text-shadow: 0 0 10px rgba(255,255,255,0.2);
        }

        .footer { 
            position: absolute; 
            bottom: 5px; 
            right: 10px; 
            font-size: 1.5vh; 
            color: #444; 
            font-family: monospace;
            z-index: 999;
        }
    </style>
</head>
<body>

    <h1>Producción</h1>
    
    <div id="dashboard" class="grid-container">
        <div class="card"><div class="label" id="t0">---</div><div class="value" id="v0">0</div></div>
        <div class="card"><div class="label" id="t1">---</div><div class="value" id="v1">0</div></div>
        <div class="card"><div class="label" id="t2">---</div><div class="value" id="v2">0</div></div>
        <div class="card"><div class="label" id="t3">---</div><div class="value" id="v3">0</div></div>
    </div>

    <div class="footer" id="status">Conectando...</div>

    <script>
        // === TUS DATOS ===
        const sheetID = '133sFEHGeZPoJXbNWvijngLV4nZgYKlbQWX30Fd4b2jk';
        const gid = '297500829';
        const range = 'B1:E2';

        // === ESTRATEGIA DE VELOCIDAD ===
        // 1. URL directa de CSV
        const googleUrl = `https://docs.google.com/spreadsheets/d/${sheetID}/export?format=csv&gid=${gid}&range=${range}`;
        
        // 2. Proxy 'CorsProxy.io' (Mucho más rápido que AllOrigins)
        // Nota: Añadimos un timestamp aleatorio al final para evitar caché del proxy
        const getProxyUrl = () => `https://corsproxy.io/?${encodeURIComponent(googleUrl)}&_=${Date.now()}`;

        async function updateDashboard() {
            try {
                const response = await fetch(getProxyUrl());
                
                if (!response.ok) throw new Error("Sin conexión");

                const text = await response.text();
                
                // Si Google nos pide login, detenemos para no saturar
                if (text.includes("<!DOCTYPE html>")) {
                    document.getElementById('status').innerText = "Error: Hoja privada";
                    document.getElementById('status').style.color = "red";
                    return;
                }

                // Parseo manual ultra-rápido (Split por líneas y comas)
                const rows = text.split(/\r?\n/);
                if (rows.length < 2) return;

                const titulos = rows[0].split(',');
                const valores = rows[1].split(',');

                // Actualización directa al DOM (sin reconstruir HTML)
                for (let i = 0; i < 4; i++) {
                    // Limpieza de comillas
                    const tituloLimpio = titulos[i] ? titulos[i].replace(/^"|"$/g, '') : '';
                    const valorLimpio = valores[i] ? valores[i].replace(/^"|"$/g, '') : '0';

                    document.getElementById(`t${i}`).innerText = tituloLimpio;
                    document.getElementById(`v${i}`).innerText = valorLimpio;
                }
                
                // Marca de tiempo
                const now = new Date();
                document.getElementById('status').innerText = 'Sync: ' + now.toLocaleTimeString();
                document.getElementById('status').style.color = "#444";

            } catch (err) {
                console.error("Reintentando...", err);
                // No cambiamos el UI si falla, para que no parpadee
            }
        }

        // 1. Ejecutar inmediatamente
        updateDashboard();

        // 2. Programar cada 60 segundos
        setInterval(updateDashboard, 60000);
    </script>
</body>
</html>
